# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å —Å–∞–π—Ç–æ–º

## 1Ô∏è‚É£ –°–æ–±—ã—Ç–∏–µ —É–¥–∞–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç —Å–∫—Ä–∏–ø—Ç –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏, –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –Ω–∞ —Å–∞–π—Ç:

```javascript
// –í —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ (content script –∏–ª–∏ background script)
window.postMessage({
  type: 'EBUSTER_SCRIPT_UNINSTALLED',
  scriptId: 'uuid-—Å–∫—Ä–∏–ø—Ç–∞'
}, '*');
```

## 2Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

–°–∞–π—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ Bridge:

```javascript
// –ù–∞ —Å–∞–π—Ç–µ (–≤ ScriptsList.tsx –∏ Dashboard.tsx)
const extensionScripts = await new Promise((resolve) => {
  window.EbusterBridge.sendMessage(
    { action: 'GET_INSTALLED_SCRIPTS' },
    (response, error) => {
      if (error) {
        resolve([]);
      } else {
        resolve(Array.isArray(response) ? response : []);
      }
    }
  );
});
```

**–í —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:**

```javascript
// –í background script —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === 'GET_INSTALLED_SCRIPTS') {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ chrome.storage.local
    chrome.storage.local.get(null, (data) => {
      const scripts = Object.entries(data)
        .filter(([key]) => key.startsWith('script_'))
        .map(([_, script]) => ({
          id: script.id,
          name: script.name,
          source: script.source || '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å —Å–∞–π—Ç–∞', // –í–ê–ñ–ù–û!
          // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
        }));
      
      sendResponse(scripts);
    });
    
    return true; // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
  }
});
```

## 3Ô∏è‚É£ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏

–ö–∞–∂–¥—ã–π —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø–æ–ª–µ `source`:

```javascript
{
  id: 'uuid-—Å–∫—Ä–∏–ø—Ç–∞',
  name: '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞',
  code: '–∫–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞',
  source: '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å —Å–∞–π—Ç–∞', // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}
```

## 4Ô∏è‚É£ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç:

1. **–°–∞–π—Ç** –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
2. **–°–∞–π—Ç** –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —á–µ—Ä–µ–∑ Bridge
3. **–°–∞–π—Ç** —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–ø–∏—Å–∫–∏
4. –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:
   - **–°–∞–π—Ç** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å–ø–∏—Å–æ–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
   - **–°–µ—Ä–≤–µ—Ä** –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É `user_scripts`
   - **–°–∞–π—Ç** –æ–±–Ω–æ–≤–ª—è–µ—Ç UI

## 5Ô∏è‚É£ –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

–ù–∞ —Å–∞–π—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
üì¶ [loadInstalledScripts] –°–∫—Ä–∏–ø—Ç—ã –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏: [...]
‚ö†Ô∏è [loadInstalledScripts] –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ! –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: 5 –í —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏: 3
üîÑ [syncUserScripts] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤: { userId: '...', count: 3 }
‚úÖ [syncUserScripts] –ó–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
```

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –ª–æ–≥–∞—Ö API:

```
üîÑ [syncUserScripts] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤: { userId: '...', count: 3 }
üóëÔ∏è [syncUserScripts] –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏...
üìù [syncUserScripts] –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏: [...]
‚úÖ [syncUserScripts] –ó–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
```

## 6Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏:

```javascript
// background.js

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–∞–π—Ç–∞
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === 'GET_INSTALLED_SCRIPTS') {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã
    chrome.storage.local.get(null, (data) => {
      const scripts = Object.entries(data)
        .filter(([key]) => key.startsWith('script_'))
        .map(([_, script]) => ({
          id: script.id,
          name: script.name,
          source: script.source || '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å —Å–∞–π—Ç–∞'
        }));
      
      console.log('üì¶ [GET_INSTALLED_SCRIPTS] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç—ã:', scripts);
      sendResponse(scripts);
    });
    
    return true; // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
  }
});

// –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
async function uninstallScript(scriptId) {
  try {
    // 1. –£–¥–∞–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç –ª–æ–∫–∞–ª—å–Ω–æ –∏–∑ chrome.storage
    await chrome.storage.local.remove(`script_${scriptId}`);
    
    // 2. –£–≤–µ–¥–æ–º–ª—è–µ–º —Å–∞–π—Ç
    window.postMessage({
      type: 'EBUSTER_SCRIPT_UNINSTALLED',
      scriptId: scriptId
    }, '*');
    
    console.log('‚úÖ –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω –∏ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞:', error);
  }
}
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç lk.ebuster.ru
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã"
4. –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
5. –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ - –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
6. –°–ø–∏—Å–æ–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
