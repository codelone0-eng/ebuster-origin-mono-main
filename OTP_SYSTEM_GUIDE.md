# ๐ ะกะธััะตะผะฐ OTP ะััะตะฝัะธัะธะบะฐัะธะธ

## โ ะงัะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ:

### 1. Backend โ

#### ะะตะฝะตัะฐัะธั OTP ะบะพะดะฐ:
- **ะคะฐะนะป:** `src/api/auth.controller.ts`
- ะะตะฝะตัะธััะตััั 6-ะทะฝะฐัะฝัะน ะบะพะด: `123456`
- ะกัะพะบ ะดะตะนััะฒะธั: **10 ะผะธะฝัั**
- ะกะพััะฐะฝัะตััั ะฒ ะฟะพะปะต `confirmation_token`
- ะะพะฑะฐะฒะปะตะฝะพ ะฟะพะปะต `otp_expiry` ะดะปั ะฟัะพะฒะตัะบะธ ะธััะตัะตะฝะธั

#### Endpoint ะฟัะพะฒะตัะบะธ OTP:
- **URL:** `POST /api/auth/verify-otp`
- **ะะฐัะฐะผะตััั:**
  ```json
  {
    "email": "user@example.com",
    "otp": "123456"
  }
  ```
- **ะัะฒะตั ะฟัะธ ััะฟะตัะต:**
  ```json
  {
    "success": true,
    "message": "Email ะฟะพะดัะฒะตัะถะดะตะฝ! ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั!",
    "token": "jwt_token_here",
    "user": {
      "id": "user_id",
      "email": "user@example.com",
      "full_name": "ะะผั ะะพะปัะทะพะฒะฐัะตะปั",
      "role": "user",
      "status": "active"
    }
  }
  ```

#### Email ั OTP ะบะพะดะพะผ:
- **ะคะฐะนะป:** `src/services/email.service.ts`
- ะะตัะพะด: `sendOtpEmail(email, otpCode, userName)`
- ะัะฐัะธะฒัะน HTML ัะฐะฑะปะพะฝ ั:
  - ะัะฐะดะธะตะฝัะฝะพะน ัะฐะผะบะพะน ะฒะพะบััะณ ะบะพะดะฐ
  - ะััะฟะฝัะผ ััะธััะพะผ (48px)
  - ะขะฐะนะผะตัะพะผ (10 ะผะธะฝัั)
  - ะัะตะดัะฟัะตะถะดะตะฝะธะตะผ ะพ ะฑะตะทะพะฟะฐัะฝะพััะธ
  - ะัะตะฝะดะธัะพะฒะฐะฝะฝัะผ ะดะธะทะฐะนะฝะพะผ

---

### 2. Frontend โ

#### ะกััะฐะฝะธัะฐ ะฒะฒะพะดะฐ OTP:
- **ะคะฐะนะป:** `src/pages/VerifyOtp.tsx`
- **URL:** `/verify-otp?email=user@example.com`
- **ะะพะผะฟะพะฝะตะฝัั:**
  - `InputOTP` - 6 ะฟะพะปะตะน ะดะปั ะฒะฒะพะดะฐ ะบะพะดะฐ
  - ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะฟัะฐะฒะบะฐ ะฟัะธ ะฒะฒะพะดะต 6 ัะธัั
  - ะะฝะพะฟะบะฐ "ะัะฟัะฐะฒะธัั ะฟะพะฒัะพัะฝะพ" ั cooldown 60 ัะตะบัะฝะด
  - ะะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ
  - ะะฝัะพัะผะฐัะธะพะฝะฝัะต ะฑะปะพะบะธ

#### ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด:
- ะะพัะปะต ััะฟะตัะฝะพะน ะฟัะพะฒะตัะบะธ OTP:
  1. ะกะพััะฐะฝัะตััั JWT ัะพะบะตะฝ
  2. ะกะพััะฐะฝััััั ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั
  3. ะะฑะฝะพะฒะปัะตััั ะบะพะฝัะตะบัั ะฐะฒัะพัะธะทะฐัะธะธ
  4. ะะฒัะพะผะฐัะธัะตัะบะพะต ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต ะฒ `/dashboard`

#### ะะฝัะตะณัะฐัะธั ั ัะตะณะธัััะฐัะธะตะน:
- **ะคะฐะนะป:** `src/contexts/CustomAuthContext.tsx`
- ะะพัะปะต ััะฟะตัะฝะพะน ัะตะณะธัััะฐัะธะธ:
  1. ะะพะบะฐะทัะฒะฐะตััั ัะฒะตะดะพะผะปะตะฝะธะต
  2. ะงะตัะตะท 1.5 ัะตะบัะฝะดั ะฟะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต ะฝะฐ `/verify-otp?email=...`

---

## ๐จ UI/UX ะัะพะฑะตะฝะฝะพััะธ:

### ะกััะฐะฝะธัะฐ ะฒะฒะพะดะฐ OTP:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ๐ง ะะพะดัะฒะตัะถะดะตะฝะธะต Email      โ
โ                                     โ
โ  ะั ะพัะฟัะฐะฒะธะปะธ 6-ะทะฝะฐัะฝัะน ะบะพะด ะฝะฐ     โ
โ  user@example.com                  โ
โ                                     โ
โ  โโโโโฌโโโโฌโโโโ โข โโโโโฌโโโโฌโโโโ    โ
โ  โ 1 โ 2 โ 3 โ   โ 4 โ 5 โ 6 โ    โ
โ  โโโโโดโโโโดโโโโ   โโโโโดโโโโดโโโโ    โ
โ                                     โ
โ  โ ะะพะด ะดะตะนััะฒะธัะตะปะตะฝ 10 ะผะธะฝัั      โ
โ  โ๏ธ ะะต ะฟะพะปััะธะปะธ ะบะพะด?               โ
โ                                     โ
โ  [ะัะฟัะฐะฒะธัั ะบะพะด ะฟะพะฒัะพัะฝะพ]          โ
โ  [ะะตัะฝััััั ะบ ัะตะณะธัััะฐัะธะธ]         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Email ัะฐะฑะปะพะฝ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         EBUSTER                   โ
โ   ะะฐััะธัะตะฝะธะต ะฝะพะฒะพะณะพ ะฟะพะบะพะปะตะฝะธั     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ                                   โ
โ  ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั, ะะผั!          โ
โ                                   โ
โ  ะะฐั ะบะพะด ะฟะพะดัะฒะตัะถะดะตะฝะธั:          โ
โ                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโ            โ
โ  โ                   โ            โ
โ  โ     1 2 3 4 5 6   โ            โ
โ  โ                   โ            โ
โ  โโโโโโโโโโโโโโโโโโโโโ            โ
โ                                   โ
โ  โฑ ะะพะด ะดะตะนััะฒะธัะตะปะตะฝ 10 ะผะธะฝัั     โ
โ  โ๏ธ ะะธะบะพะผั ะฝะต ัะพะพะฑัะฐะนัะต ะบะพะด       โ
โ                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะัะพัะตัั ัะตะณะธัััะฐัะธะธ:

### ะกัะฐััะน ะฟัะพัะตัั (ัะพ ัััะปะบะพะน):
```
1. ะะตะณะธัััะฐัะธั โ 
2. Email ัะพ ัััะปะบะพะน โ 
3. ะะปะธะบ ะฟะพ ัััะปะบะต โ 
4. ะะพะดัะฒะตัะถะดะตะฝะธะต โ 
5. ะะพะณะธะฝ โ 
6. ะัะพะด ะฒ ัะธััะตะผั
```

### ะะพะฒัะน ะฟัะพัะตัั (ั OTP):
```
1. ะะตะณะธัััะฐัะธั โ 
2. Email ั OTP ะบะพะดะพะผ โ 
3. ะะฒะพะด ะบะพะดะฐ (6 ัะธัั) โ 
4. ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด ะฒ ัะธััะตะผั โจ
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะะตะฝััะต ัะฐะณะพะฒ (4 ะฒะผะตััะพ 6)
- โ ะะต ะฝัะถะฝะพ ะปะพะณะธะฝะธัััั
- โ ะััััะตะต ะธ ัะดะพะฑะฝะตะต
- โ ะกะพะฒัะตะผะตะฝะฝัะน UX
- โ ะะพะฑะธะปัะฝะพ-ะดััะถะตััะฒะตะฝะฝัะน

---

## ๐ ะะฐะทะฐ ะดะฐะฝะฝัั:

### ะะพะฒัะต ะฟะพะปั ะฒ ัะฐะฑะปะธัะต `auth_users`:

```sql
ALTER TABLE auth_users 
ADD COLUMN otp_expiry TIMESTAMPTZ;

-- confirmation_token ัะตะฟะตัั ััะฐะฝะธั OTP ะบะพะด (6 ัะธัั)
-- otp_expiry ััะฐะฝะธั ะฒัะตะผั ะธััะตัะตะฝะธั ะบะพะดะฐ
```

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต:

### 1. ะะตะณะธัััะฐัะธั ะฝะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั:

```bash
# ะัะบัะพะนัะต http://localhost:5173
# ะะฐะถะผะธัะต "ะะตะณะธัััะฐัะธั"
# ะะฐะฟะพะปะฝะธัะต ัะพัะผั
# ะะฐะถะผะธัะต "ะะฐัะตะณะธัััะธัะพะฒะฐัััั"
```

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะฃะฒะตะดะพะผะปะตะฝะธะต: "ะะพะด ะฟะพะดัะฒะตัะถะดะตะฝะธั ะพัะฟัะฐะฒะปะตะฝ"
- โ ะะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต ะฝะฐ `/verify-otp?email=...`
- โ Email ั 6-ะทะฝะฐัะฝัะผ ะบะพะดะพะผ

### 2. ะัะพะฒะตัะบะฐ email:

ะัะบัะพะนัะต ะฟะพะปััะตะฝะฝะพะต ะฟะธััะผะพ:
```
ะขะตะผะฐ: ะะพะด ะฟะพะดัะฒะตัะถะดะตะฝะธั - EBUSTER

ะะฐั ะบะพะด: 123456

โฑ ะะพะด ะดะตะนััะฒะธัะตะปะตะฝ 10 ะผะธะฝัั
```

### 3. ะะฒะพะด OTP ะบะพะดะฐ:

ะะฐ ัััะฐะฝะธัะต `/verify-otp`:
- ะะฒะตะดะธัะต 6 ัะธัั ะธะท email
- ะะพะด ะฟัะพะฒะตััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- ะัะธ ััะฟะตัะต: ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
- โ ะฃะฒะตะดะพะผะปะตะฝะธะต: "Email ะฟะพะดัะฒะตัะถะดะตะฝ! ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั!"
- โ ะะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต ะฒ `/dashboard`
- โ ะะพะปัะทะพะฒะฐัะตะปั ะฐะฒัะพัะธะทะพะฒะฐะฝ

### 4. ะัะพะฒะตัะบะฐ ะธััะตัะตะฝะธั ะบะพะดะฐ:

ะะพะดะพะถะดะธัะต 10 ะผะธะฝัั ะธ ะฟะพะฟัะพะฑัะนัะต ะฒะฒะตััะธ ะบะพะด:
```json
{
  "success": false,
  "error": "OTP ะบะพะด ะธััะตะบ. ะะพะถะฐะปัะนััะฐ, ะทะฐัะตะณะธัััะธััะนัะตัั ะทะฐะฝะพะฒะพ."
}
```

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั:

### ะะฐัะธัะฐ ะพั ะฑััััะพััะฐ:
- โฑ ะะพะด ะดะตะนััะฒะธัะตะปะตะฝ ัะพะปัะบะพ 10 ะผะธะฝัั
- ๐ข 6-ะทะฝะฐัะฝัะน ะบะพะด (1 ะผะธะปะปะธะพะฝ ะบะพะผะฑะธะฝะฐัะธะน)
- ๐ซ ะะพัะปะต ะธััะตัะตะฝะธั ะฝัะถะฝะฐ ะฝะพะฒะฐั ัะตะณะธัััะฐัะธั

### ะะตะบะพะผะตะฝะดะฐัะธะธ ะดะปั production:
1. **Rate limiting:** ะะณัะฐะฝะธัะธัั ะบะพะปะธัะตััะฒะพ ะฟะพะฟััะพะบ ะฒะฒะพะดะฐ OTP
2. **IP tracking:** ะััะปะตะถะธะฒะฐัั ะฟะพะดะพะทัะธัะตะปัะฝัั ะฐะบัะธะฒะฝะพััั
3. **Captcha:** ะะพะฑะฐะฒะธัั ะฟัะธ ะฟะพะฒัะพัะฝะพะน ะพัะฟัะฐะฒะบะต ะบะพะดะฐ
4. **ะะพะณะธัะพะฒะฐะฝะธะต:** ะะฐะฟะธััะฒะฐัั ะฒัะต ะฟะพะฟััะบะธ ะฟัะพะฒะตัะบะธ OTP

---

## ๐ API ะะพะบัะผะตะฝัะฐัะธั:

### POST /api/auth/register

**Request:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "fullName": "ะะฒะฐะฝ ะะฒะฐะฝะพะฒ"
}
```

**Response:**
```json
{
  "success": true,
  "emailSent": true,
  "message": "ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐะฝ. ะะธััะผะพ ะพัะฟัะฐะฒะปะตะฝะพ.",
  "userId": "user_id_here"
}
```

**Email ัะพะดะตัะถะธั:**
- 6-ะทะฝะฐัะฝัะน OTP ะบะพะด
- ะกัะพะบ ะดะตะนััะฒะธั: 10 ะผะธะฝัั

---

### POST /api/auth/verify-otp

**Request:**
```json
{
  "email": "user@example.com",
  "otp": "123456"
}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "Email ะฟะพะดัะฒะตัะถะดะตะฝ! ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั!",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "full_name": "ะะฒะฐะฝ ะะฒะฐะฝะพะฒ",
    "role": "user",
    "status": "active"
  }
}
```

**Response (Error - ะะตะฒะตัะฝัะน ะบะพะด):**
```json
{
  "success": false,
  "error": "ะะตะฒะตัะฝัะน OTP ะบะพะด ะธะปะธ email"
}
```

**Response (Error - ะััะตะบ):**
```json
{
  "success": false,
  "error": "OTP ะบะพะด ะธััะตะบ. ะะพะถะฐะปัะนััะฐ, ะทะฐัะตะณะธัััะธััะนัะตัั ะทะฐะฝะพะฒะพ."
}
```

---

## ๐ ะะตะฟะปะพะน:

### 1. ะะฑะฝะพะฒะธัะต ะฑะฐะทั ะดะฐะฝะฝัั:

```sql
-- ะะพะฑะฐะฒััะต ะฟะพะปะต otp_expiry
ALTER TABLE auth_users 
ADD COLUMN IF NOT EXISTS otp_expiry TIMESTAMPTZ;
```

### 2. ะะตัะตะทะฐะฟัััะธัะต backend:

```bash
npm run dev
```

### 3. ะัะพะฒะตัััะต frontend:

```bash
# ะฃะฑะตะดะธัะตัั ััะพ ัะพัั /verify-otp ัะฐะฑะพัะฐะตั
# ะัะพะฒะตัััะต ััะพ ะบะพะผะฟะพะฝะตะฝั InputOTP ัััะตััะฒัะตั
```

---

## โ ะงะตะบะปะธัั ะณะพัะพะฒะฝะพััะธ:

- [x] Backend ะณะตะฝะตัะธััะตั 6-ะทะฝะฐัะฝัะน OTP
- [x] OTP ัะพััะฐะฝัะตััั ะฒ ะะ ั ะฒัะตะผะตะฝะตะผ ะธััะตัะตะฝะธั
- [x] Endpoint `/api/auth/verify-otp` ัะฐะฑะพัะฐะตั
- [x] Email ั OTP ะพัะฟัะฐะฒะปัะตััั
- [x] ะกััะฐะฝะธัะฐ `/verify-otp` ัะพะทะดะฐะฝะฐ
- [x] ะะพะผะฟะพะฝะตะฝั InputOTP ะธะฝัะตะณัะธัะพะฒะฐะฝ
- [x] ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะพะด ะฟะพัะปะต ะฟัะพะฒะตัะบะธ OTP
- [x] ะะตัะตะฝะฐะฟัะฐะฒะปะตะฝะธะต ะฟะพัะปะต ัะตะณะธัััะฐัะธะธ
- [x] ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
- [x] Cooldown ะดะปั ะฟะพะฒัะพัะฝะพะน ะพัะฟัะฐะฒะบะธ

---

## ๐ ะะพัะพะฒะพ!

ะกะธััะตะผะฐ OTP ะฟะพะปะฝะพัััั ะธะฝัะตะณัะธัะพะฒะฐะฝะฐ ะธ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!

**ะะพะปัะทะพะฒะฐัะตะปะธ ัะตะฟะตัั ะผะพะณัั:**
1. ะะฐัะตะณะธัััะธัะพะฒะฐัััั
2. ะะพะปััะธัั OTP ะบะพะด ะฝะฐ email
3. ะะฒะตััะธ ะบะพะด (6 ัะธัั)
4. ะะฒัะพะผะฐัะธัะตัะบะธ ะฒะพะนัะธ ะฒ ัะธััะตะผั

**ะะตะท ะฝะตะพะฑัะพะดะธะผะพััะธ:**
- โ ะะปะธะบะฐัั ะฟะพ ัััะปะบะฐะผ
- โ ะะฒะพะดะธัั ะปะพะณะธะฝ/ะฟะฐัะพะปั ะฟะพะฒัะพัะฝะพ
- โ ะะดะฐัั ะดะพะปะณะธั ัะตะดะธัะตะบัะพะฒ

**ะกะพะฒัะตะผะตะฝะฝะพ, ะฑััััะพ, ัะดะพะฑะฝะพ!** โจ
