#!/bin/bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ü–û–°–õ–ï –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è

set -e

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ –ø–æ—Å–ª–µ –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è"
echo "=========================================="

cd /srv/ebuster

echo ""
echo "1Ô∏è‚É£ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker compose down

echo ""
echo "2Ô∏è‚É£ –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π volume —Å–æ —Å–≤–µ—Ç–ª—ã–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–º..."
docker volume rm ebuster_autotest_reports || echo "Volume —É–∂–µ —É–¥–∞–ª—ë–Ω"

echo ""
echo "3Ô∏è‚É£ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã..."
docker compose up -d

echo ""
echo "4Ô∏è‚É£ –ñ–¥—ë–º 5 —Å–µ–∫—É–Ω–¥..."
sleep 5

echo ""
echo "5Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å..."
docker compose ps

echo ""
echo "6Ô∏è‚É£ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç—ë–º–Ω—ã–π –¥–∞—à–±–æ—Ä–¥)..."
docker compose run --rm autotest-runner npm run test:all

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –û—Ç–∫—Ä–æ–π—Ç–µ https://autotest.ebuster.ru –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å Ctrl+Shift+R"
