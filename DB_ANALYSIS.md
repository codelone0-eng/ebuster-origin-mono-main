# üìä –ê–ù–ê–õ–ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–•

## ‚úÖ –ß—Ç–æ –µ—Å—Ç—å –≤ –ë–î:

### –¢–∞–±–ª–∏—Ü—ã (21):
1. **auth_users** (24 –∫–æ–ª–æ–Ω–∫–∏) - 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **roles** (13 –∫–æ–ª–æ–Ω–æ–∫) - 5 —Ä–æ–ª–µ–π ‚úÖ
3. **subscriptions** (14 –∫–æ–ª–æ–Ω–æ–∫) - 0 –ø–æ–¥–ø–∏—Å–æ–∫
4. **scripts** (24 –∫–æ–ª–æ–Ω–∫–∏) - 3 —Å–∫—Ä–∏–ø—Ç–∞
5. **script_categories** (10 –∫–æ–ª–æ–Ω–æ–∫) - 4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
6. **script_downloads** (6 –∫–æ–ª–æ–Ω–æ–∫) - 131 –∑–∞–≥—Ä—É–∑–∫–∞
7. **script_ratings** (7 –∫–æ–ª–æ–Ω–æ–∫) - 3 –æ—Ü–µ–Ω–∫–∏
8. **script_versions** (12 –∫–æ–ª–æ–Ω–æ–∫) - 1 –≤–µ—Ä—Å–∏—è
9. **support_tickets** (12 –∫–æ–ª–æ–Ω–æ–∫) - 4 —Ç–∏–∫–µ—Ç–∞
10. **ticket_messages** (7 –∫–æ–ª–æ–Ω–æ–∫) - 5 —Å–æ–æ–±—â–µ–Ω–∏–π
11. **ticket_comments** (6 –∫–æ–ª–æ–Ω–æ–∫) - 2 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
12. **ticket_attachments** (10 –∫–æ–ª–æ–Ω–æ–∫) - 0 –≤–ª–æ–∂–µ–Ω–∏–π
13. **user_scripts** (4 –∫–æ–ª–æ–Ω–∫–∏) - 0 —É—Å—Ç–∞–Ω–æ–≤–æ–∫
14. **user_script_updates** (7 –∫–æ–ª–æ–Ω–æ–∫) - 0 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
15. **user_autoupdate_settings** (6 –∫–æ–ª–æ–Ω–æ–∫) - 0 –Ω–∞—Å—Ç—Ä–æ–µ–∫
16. **user_bans** (14 –∫–æ–ª–æ–Ω–æ–∫) - 0 –±–∞–Ω–æ–≤
17. **referral_codes** (11 –∫–æ–ª–æ–Ω–æ–∫) - 4 –∫–æ–¥–∞
18. **referral_stats** (10 –∫–æ–ª–æ–Ω–æ–∫) - 4 —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
19. **referral_history** (8 –∫–æ–ª–æ–Ω–æ–∫) - 0 –∏—Å—Ç–æ—Ä–∏–∏
20. **referral_rewards** (10 –∫–æ–ª–æ–Ω–æ–∫) - 0 –Ω–∞–≥—Ä–∞–¥
21. **referral_uses** (10 –∫–æ–ª–æ–Ω–æ–∫) - 0 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–´:

### 1. ‚ùå Subscriptions - –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è
**–ü—Ä–æ–±–ª–µ–º–∞:** API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ë–î:
- `amount` - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
- `plan` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞
- `features` - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∏ –ø–æ–ª—è (–º–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞)

---

### 2. ‚ùå Scripts - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ category
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –í –ë–î: `category` (VARCHAR)
- –í –∫–æ–¥–µ: `category_id` (UUID)

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```sql
scripts.category VARCHAR  -- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```sql
scripts.category_id UUID ‚Üí script_categories.id  -- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `category` –≤ `category_id` –∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø

---

### 3. ‚ùå Auth_users - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:
- `role` (VARCHAR) - —Å—Ç–∞—Ä–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
- `role_id` (UUID) - –Ω–æ–≤–æ–µ –ø–æ–ª–µ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ roles

**–î–∞–Ω–Ω—ã–µ:**
```
email                    | old_role | new_role
-------------------------|----------|----------
codelone0@gmail.com      | admin    | admin
plutoniy2033@gmail.com   | admin    | admin
bespredel.owner@mail.ru  | admin    | admin
stayalive019@gmail.com   | user     | free
```

**–†–µ—à–µ–Ω–∏–µ:** –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å `role` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `role_id`

---

### 4. ‚ö†Ô∏è User_scripts - –±–∏—Ç–∞—è —Å–≤—è–∑—å
**–ü—Ä–æ–±–ª–µ–º–∞:** Foreign key –Ω–∞ `user_id` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!

**–¢–µ–∫—É—â–∏–µ FK:**
```sql
user_scripts.script_id ‚Üí scripts.id  ‚úÖ
user_scripts.user_id ‚Üí ???  ‚ùå –ù–ï–¢!
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å FK –Ω–∞ `auth_users.id`

---

### 5. ‚ö†Ô∏è RLS –æ—Ç–∫–ª—é—á–µ–Ω –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** Row Level Security –æ—Ç–∫–ª—é—á–µ–Ω –Ω–∞:
- `roles` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω
- `subscriptions` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω  
- `script_versions` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω
- `ticket_messages` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω
- `user_autoupdate_settings` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω
- `user_script_updates` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–∏—Ç—å RLS –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û:

1. ‚úÖ **Roles** - —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞, 5 —Ä–æ–ª–µ–π –µ—Å—Ç—å
2. ‚úÖ **Foreign Keys** - –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–≤—è–∑–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã** - —Ö–æ—Ä–æ—à–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
4. ‚úÖ **Auth_users.role_id** - —Å–≤—è–∑—å —Å roles —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üéØ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

### –ú–∏–≥—Ä–∞—Ü–∏—è 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ subscriptions
```sql
ALTER TABLE subscriptions ADD COLUMN amount DECIMAL(10, 2) DEFAULT 0;
ALTER TABLE subscriptions ADD COLUMN plan VARCHAR(50);
ALTER TABLE subscriptions ADD COLUMN features JSONB DEFAULT '[]'::jsonb;
```

### –ú–∏–≥—Ä–∞—Ü–∏—è 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ scripts.category
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ
ALTER TABLE scripts ADD COLUMN category_id UUID;

-- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ category —Å–æ–¥–µ—Ä–∂–∏—Ç UUID)
UPDATE scripts SET category_id = category::uuid WHERE category IS NOT NULL;

-- –î–æ–±–∞–≤–∏—Ç—å FK
ALTER TABLE scripts ADD CONSTRAINT fk_scripts_category_id 
FOREIGN KEY (category_id) REFERENCES script_categories(id);

-- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
-- ALTER TABLE scripts DROP COLUMN category;
```

### –ú–∏–≥—Ä–∞—Ü–∏—è 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ user_scripts FK
```sql
ALTER TABLE user_scripts 
ADD CONSTRAINT fk_user_scripts_user_id 
FOREIGN KEY (user_id) REFERENCES auth_users(id) ON DELETE CASCADE;
```

### –ú–∏–≥—Ä–∞—Ü–∏—è 4: –í–∫–ª—é—á–µ–Ω–∏–µ RLS
```sql
ALTER TABLE roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;
-- + –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
```

---

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê:

- **–í—Å–µ–≥–æ —Ç–∞–±–ª–∏—Ü:** 21
- **–í—Å–µ–≥–æ FK:** 31
- **–í—Å–µ–≥–æ –∏–Ω–¥–µ–∫—Å–æ–≤:** 100+
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 4
- **–†–æ–ª–µ–π:** 5
- **–°–∫—Ä–∏–ø—Ç–æ–≤:** 3
- **–ó–∞–≥—Ä—É–∑–æ–∫:** 131

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

1. ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é subscriptions
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å scripts.category ‚Üí category_id
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å FK –Ω–∞ user_scripts.user_id
4. ‚úÖ –í–∫–ª—é—á–∏—Ç—å RLS
5. ‚úÖ –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å API
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

---

–°–æ–∑–¥–∞—é –º–∏–≥—Ä–∞—Ü–∏–∏...
