# –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ç–∏–∫–µ—Ç–æ–≤

## –†–µ–∑—é–º–µ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–∏–∫–µ—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–ª–æ–∂–µ–Ω–∏–π, —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –∏ —É–ª—É—á—à–µ–Ω–Ω—ã–º UI.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –°–∏—Å—Ç–µ–º–∞ —Ç–∏–∫–µ—Ç–æ–≤
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å—Ç–∞—Ç—É—Å–æ–≤ –≤–º–µ—Å—Ç–æ dropdown
- ‚úÖ –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω —Ç–∏–∫–µ—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏

### 2. Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ Polling –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º —Ç–∏–∫–µ—Ç–µ
- ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ polling –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏

### 3. –§–∏–ª—å—Ç—Ä—ã
- ‚úÖ –ü–æ —Å—Ç–∞—Ç—É—Å—É (–≤—Å–µ, –Ω–æ–≤—ã–µ, –≤ —Ä–∞–±–æ—Ç–µ, –æ–∂–∏–¥–∞—é—Ç –∫–ª–∏–µ–Ω—Ç–∞, —Ä–µ—à–µ–Ω–Ω—ã–µ, –∑–∞–∫—Ä—ã—Ç—ã–µ)
- ‚úÖ –ü–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–≤—Å–µ, –Ω–∏–∑–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, –≤—ã—Å–æ–∫–∏–π, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
- ‚úÖ –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤—Å–µ, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è, –æ–ø–ª–∞—Ç–∞, –æ–±—â–∞—è, –æ—à–∏–±–∫–∞)
- ‚úÖ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤

### 4. –í–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ —Å drag & drop
- ‚úÖ –ü—Ä–µ–≤—å—é –≤–ª–æ–∂–µ–Ω–∏–π
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### 5. UI —É–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∞–π–¥–±–∞—Ä –¥–∞—à–±–æ—Ä–¥–∞ (—à–∏—Ä–∏–Ω–∞ 64)
- ‚úÖ –ü–æ–ª–Ω—ã–µ –Ω–∞–¥–ø–∏—Å–∏ –≤ —Å–∞–π–¥–±–∞—Ä–µ
- ‚úÖ –ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ —Å–≤–µ—Ä–Ω—É—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å–æ–æ–±—â–µ–Ω–∏–π

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- `supabase/migrations/20250201_rename_ticket_comments_to_messages.sql` - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- `supabase/migrations/20250201_add_ticket_attachments.sql` - –¢–∞–±–ª–∏—Ü–∞ –≤–ª–æ–∂–µ–Ω–∏–π
- `supabase/migrations/20250202_setup_ticket_attachments_storage.sql` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Storage

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `src/components/ui/status-progress.tsx` - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å—Ç–∞—Ç—É—Å–æ–≤
- `src/components/ui/file-upload.tsx` - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- `src/components/ui/attachment-list.tsx` - –°–ø–∏—Å–æ–∫ –≤–ª–æ–∂–µ–Ω–∏–π

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/admin/TicketsManagement.tsx` - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- `src/api/tickets-new.controller.ts` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- `src/api/tickets-new.routes.ts` - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ä–æ—É—Ç—ã –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
- `src/lk/Dashboard.tsx` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∞–π–¥–±–∞—Ä

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –¢–∞–±–ª–∏—Ü–∞: ticket_attachments
```sql
CREATE TABLE ticket_attachments (
    id UUID PRIMARY KEY,
    ticket_id UUID REFERENCES support_tickets,
    message_id UUID REFERENCES ticket_messages,
    filename VARCHAR(255),
    original_filename VARCHAR(255),
    file_path VARCHAR(500),
    file_size BIGINT,
    mime_type VARCHAR(100),
    uploaded_by UUID REFERENCES auth_users,
    created_at TIMESTAMP
);
```

### Storage bucket: ticket-attachments
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π bucket
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, PDF, –¥–æ–∫—É–º–µ–Ω—Ç—ã Office, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

## üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Supabase
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor:
-- 1. 20250201_rename_ticket_comments_to_messages.sql
-- 2. 20250201_add_ticket_attachments.sql  
-- 3. 20250202_setup_ticket_attachments_storage.sql
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Storage –≤ Supabase Dashboard
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ Storage
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ bucket `ticket-attachments` —Å–æ–∑–¥–∞–Ω
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
npm run build
npm start
```

## üé® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ UI

### –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å—Ç–∞—Ç—É—Å–æ–≤
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
- –ö–ª–∏–∫ –ø–æ —Å—Ç–∞—Ç—É—Å—É –º–µ–Ω—è–µ—Ç –µ–≥–æ
- –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- Drag & drop –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å 10MB)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- –ü—Ä–µ–≤—å—é –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π
- –ò–∫–æ–Ω–∫–∏ –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- –¢–∏–ø —Ñ–∞–π–ª–∞
- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- –£–¥–∞–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)

## üìä API Endpoints

### –¢–∏–∫–µ—Ç—ã
- `GET /api/tickets` - –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–∏ —Ç–∏–∫–µ—Ç—ã
- `GET /api/tickets/all` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–∏–∫–µ—Ç—ã (–∞–¥–º–∏–Ω)
- `GET /api/tickets/:id` - –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–∫–µ—Ç
- `POST /api/tickets` - –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç
- `PATCH /api/tickets/:id` - –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–∫–µ—Ç

### –°–æ–æ–±—â–µ–Ω–∏—è
- `GET /api/tickets/:id/messages` - –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
- `POST /api/tickets/:id/messages` - –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

### –í–ª–æ–∂–µ–Ω–∏—è
- `POST /api/tickets/:ticketId/attachments` - –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–ª–æ–∂–µ–Ω–∏–µ
- `POST /api/tickets/:ticketId/messages/:messageId/attachments` - –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–ª–æ–∂–µ–Ω–∏–µ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –≤–ª–æ–∂–µ–Ω–∏—è
- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ –≤–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- Sanitization –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤

## üöÄ Realtime

### Polling
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
- –ê–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–º —Ç–∏–∫–µ—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### TODO –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –≤ Supabase Storage
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π

### –£–ª—É—á—à–µ–Ω–∏—è
- WebSocket –≤–º–µ—Å—Ç–æ polling –¥–ª—è realtime
- Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –ü–æ–∏—Å–∫ –ø–æ —Ç–∏–∫–µ—Ç–∞–º
- –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Ç–∏–∫–µ—Ç–æ–≤
- –®–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL)
- –ù–µ—Ç –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
–°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ –∫–æ–¥–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- `src/components/ui/status-progress.tsx`
- `src/components/ui/file-upload.tsx`
- `src/components/ui/attachment-list.tsx`

### API
–°–º. –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã:
- `src/api/tickets-new.controller.ts`
- `src/api/tickets-new.routes.ts`

